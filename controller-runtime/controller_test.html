
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>コントローラーのテスト(Envtest) · つくって学ぶKubebuilder</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.4">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="webhook.html" />
    
    
    <link rel="prev" href="reconcile.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    つくって学ぶKubebuilder
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../introduction/installation.html">
            
                <a href="../introduction/installation.html">
            
                    
                    インストール
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../introduction/basics.html">
            
                <a href="../introduction/basics.html">
            
                    
                    カスタムコントローラーの基礎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../introduction/sample.html">
            
                <a href="../introduction/sample.html">
            
                    
                    MarkdownViewコントローラー
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../introduction/references.html">
            
                <a href="../introduction/references.html">
            
                    
                    参考情報
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../kubebuilder/">
            
                <a href="../kubebuilder/">
            
                    
                    Kubebuilder
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../kubebuilder/new-project.html">
            
                <a href="../kubebuilder/new-project.html">
            
                    
                    プロジェクトの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../kubebuilder/api.html">
            
                <a href="../kubebuilder/api.html">
            
                    
                    APIの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../kubebuilder/webhook.html">
            
                <a href="../kubebuilder/webhook.html">
            
                    
                    Webhookの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../kubebuilder/kind.html">
            
                <a href="../kubebuilder/kind.html">
            
                    
                    カスタムコントローラーの動作確認
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../kubebuilder/release.html">
            
                <a href="../kubebuilder/release.html">
            
                    
                    カスタムコントローラーのリリース
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../controller-tools/">
            
                <a href="../controller-tools/">
            
                    
                    controller-tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../controller-tools/crd.html">
            
                <a href="../controller-tools/crd.html">
            
                    
                    CRDマニフェストの生成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../controller-tools/rbac.html">
            
                <a href="../controller-tools/rbac.html">
            
                    
                    RBACマニフェストの生成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../controller-tools/webhook.html">
            
                <a href="../controller-tools/webhook.html">
            
                    
                    Webhookマニフェストの生成
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    controller-runtime
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="client.html">
            
                <a href="client.html">
            
                    
                    クライアントの使い方
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="test.html">
            
                <a href="test.html">
            
                    
                    テスト
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="reconcile.html">
            
                <a href="reconcile.html">
            
                    
                    Reconcileの実装
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.4" data-path="controller_test.html">
            
                <a href="controller_test.html">
            
                    
                    コントローラーのテスト(Envtest)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="webhook.html">
            
                <a href="webhook.html">
            
                    
                    Webhookの実装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="webhook_test.html">
            
                <a href="webhook_test.html">
            
                    
                    Webhookのテスト(Envtest)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="deletion.html">
            
                <a href="deletion.html">
            
                    
                    リソースの削除
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="manager.html">
            
                <a href="manager.html">
            
                    
                    Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="monitoring.html">
            
                <a href="monitoring.html">
            
                    
                    モニタリング
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >コントローラーのテスト(Envtest)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="コントローラーのテストenvtest">コントローラーのテスト(Envtest)</h1>
<p>ここではEnvtestを利用したカスタムコントローラーのテストの書き方を学びます。</p>
<h2 id="テスト環境のセットアップ">テスト環境のセットアップ</h2>
<p>まず、自動生成された<code>internal/controller/suite_test.go</code>を見てみましょう。</p>
<blockquote>
<p><a id="internal/controller/suite_test.go" href="https://github.com/zoetrope/kubebuilder-training/blob/master/docs/kubebuilder/../../codes/40_reconcile/internal/controller/suite_test.go" target="_blank">internal/controller/suite_test.go</a></p>
</blockquote>
<pre><code class="lang-golang"><span class="hljs-comment">/*
Copyright 2024.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/</span>

<span class="hljs-keyword">package</span> controller

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"path/filepath"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"testing"</span>

    . <span class="hljs-string">"github.com/onsi/ginkgo/v2"</span>
    . <span class="hljs-string">"github.com/onsi/gomega"</span>
    apiruntime <span class="hljs-string">"k8s.io/apimachinery/pkg/runtime"</span>
    clientgoscheme <span class="hljs-string">"k8s.io/client-go/kubernetes/scheme"</span>
    <span class="hljs-string">"k8s.io/client-go/rest"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/client"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/envtest"</span>
    logf <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/log"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/log/zap"</span>

    viewv1 <span class="hljs-string">"github.com/zoetrope/markdown-view/api/v1"</span>
    <span class="hljs-comment">// +kubebuilder:scaffold:imports</span>
)

<span class="hljs-comment">// These tests use Ginkgo (BDD-style Go testing framework). Refer to</span>
<span class="hljs-comment">// http://onsi.github.io/ginkgo/ to learn more about Ginkgo.</span>

<span class="hljs-keyword">var</span> cfg *rest.Config
<span class="hljs-keyword">var</span> k8sClient client.Client
<span class="hljs-keyword">var</span> testEnv *envtest.Environment
<span class="hljs-keyword">var</span> scheme = apiruntime.NewScheme()

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestControllers</span><span class="hljs-params">(t *testing.T)</span></span> {
    RegisterFailHandler(Fail)

    RunSpecs(t, <span class="hljs-string">"Controller Suite"</span>)
}

<span class="hljs-keyword">var</span> _ = BeforeSuite(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    logf.SetLogger(zap.New(zap.WriteTo(GinkgoWriter), zap.UseDevMode(<span class="hljs-literal">true</span>)))

    By(<span class="hljs-string">"bootstrapping test environment"</span>)
    testEnv = &amp;envtest.Environment{
        CRDDirectoryPaths:     []<span class="hljs-type">string</span>{filepath.Join(<span class="hljs-string">".."</span>, <span class="hljs-string">".."</span>, <span class="hljs-string">"config"</span>, <span class="hljs-string">"crd"</span>, <span class="hljs-string">"bases"</span>)},
        ErrorIfCRDPathMissing: <span class="hljs-literal">true</span>,

        <span class="hljs-comment">// The BinaryAssetsDirectory is only required if you want to run the tests directly</span>
        <span class="hljs-comment">// without call the makefile target test. If not informed it will look for the</span>
        <span class="hljs-comment">// default path defined in controller-runtime which is /usr/local/kubebuilder/.</span>
        <span class="hljs-comment">// Note that you must have the required binaries setup under the bin directory to perform</span>
        <span class="hljs-comment">// the tests directly. When we run make test it will be setup and used automatically.</span>
        BinaryAssetsDirectory: filepath.Join(<span class="hljs-string">".."</span>, <span class="hljs-string">".."</span>, <span class="hljs-string">"bin"</span>, <span class="hljs-string">"k8s"</span>,
            fmt.Sprintf(<span class="hljs-string">"1.30.0-%s-%s"</span>, runtime.GOOS, runtime.GOARCH)),
    }

    <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>
    <span class="hljs-comment">// cfg is defined in this file globally.</span>
    cfg, err = testEnv.Start()
    Expect(err).NotTo(HaveOccurred())
    Expect(cfg).NotTo(BeNil())

    err = viewv1.AddToScheme(scheme)
    Expect(err).NotTo(HaveOccurred())
    err = clientgoscheme.AddToScheme(scheme)
    Expect(err).NotTo(HaveOccurred())

    <span class="hljs-comment">// +kubebuilder:scaffold:scheme</span>

    k8sClient, err = client.New(cfg, client.Options{Scheme: scheme})
    Expect(err).NotTo(HaveOccurred())
    Expect(k8sClient).NotTo(BeNil())

})

<span class="hljs-keyword">var</span> _ = AfterSuite(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    By(<span class="hljs-string">"tearing down the test environment"</span>)
    err := testEnv.Stop()
    Expect(err).NotTo(HaveOccurred())
})
</code></pre>
<p>最初に<code>envtest.Environment</code>でテスト用の環境設定をおこなっています。
<code>CRDDirectoryPaths</code>で適用するCRDのマニフェストのパスを指定し、BinaryAssetsDirectoryでEnvtestのバイナリファイルのディレクトリを指定しています。</p>
<p><code>testEnv.Start()</code>を呼び出すとetcdとkube-apiserverが起動します。
あとはカスタムコントローラーのmain関数と同様にscheme初期化処理をおこない、最後にEnvtestのapiserverに接続するためのクライアントを作成しています。</p>
<p>テスト終了時にはetcdとkube-apiserverを終了するように、AfterSuiteで<code>testEnv.Stop()</code>を呼び出します。</p>
<h2 id="コントローラーのテスト">コントローラーのテスト</h2>
<p>それでは実際のテストを書いていきましょう。</p>
<blockquote>
<p><a id="markdownview_controller_test.go" href="https://github.com/zoetrope/kubebuilder-training/blob/master/docs/kubebuilder/../../codes/40_reconcile/internal/controller/markdownview_controller_test.go" target="_blank">markdownview_controller_test.go</a></p>
</blockquote>
<pre><code class="lang-golang"><span class="hljs-comment">/*
Copyright 2024.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/</span>

<span class="hljs-keyword">package</span> controller

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"k8s.io/utils/ptr"</span>

    . <span class="hljs-string">"github.com/onsi/ginkgo/v2"</span>
    . <span class="hljs-string">"github.com/onsi/gomega"</span>
    viewv1 <span class="hljs-string">"github.com/zoetrope/markdown-view/api/v1"</span>
    appsv1 <span class="hljs-string">"k8s.io/api/apps/v1"</span>
    corev1 <span class="hljs-string">"k8s.io/api/core/v1"</span>
    apierrors <span class="hljs-string">"k8s.io/apimachinery/pkg/api/errors"</span>
    metav1 <span class="hljs-string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span>
    <span class="hljs-string">"k8s.io/apimachinery/pkg/types"</span>
    <span class="hljs-string">"k8s.io/apimachinery/pkg/util/intstr"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/client"</span>
    <span class="hljs-string">"sigs.k8s.io/controller-runtime/pkg/reconcile"</span>
)

<span class="hljs-keyword">var</span> _ = Describe(<span class="hljs-string">"MarkdownView Controller"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    Context(<span class="hljs-string">"When reconciling a resource"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">const</span> resourceName = <span class="hljs-string">"sample"</span>
        <span class="hljs-keyword">const</span> testNamespace = <span class="hljs-string">"test"</span>

        ctx := context.Background()

        typeNamespacedName := types.NamespacedName{
            Name:      resourceName,
            Namespace: testNamespace,
        }

        BeforeEach(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            By(<span class="hljs-string">"creating the namespace for the test"</span>)
            ns := &amp;corev1.Namespace{}
            ns.Name = testNamespace
            err := k8sClient.Create(context.Background(), ns)
            Expect(err).NotTo(HaveOccurred())

            By(<span class="hljs-string">"creating the custom resource for the Kind MarkdownView"</span>)
            markdownview := &amp;viewv1.MarkdownView{}
            err = k8sClient.Get(ctx, typeNamespacedName, markdownview)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &amp;&amp; apierrors.IsNotFound(err) {
                resource := &amp;viewv1.MarkdownView{
                    ObjectMeta: metav1.ObjectMeta{
                        Name:      resourceName,
                        Namespace: testNamespace,
                    },
                    Spec: viewv1.MarkdownViewSpec{
                        Markdowns: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
                            <span class="hljs-string">"SUMMARY.md"</span>: <span class="hljs-string">`summary`</span>,
                            <span class="hljs-string">"page1.md"</span>:   <span class="hljs-string">`page1`</span>,
                        },
                        Replicas:    <span class="hljs-number">3</span>,
                        ViewerImage: <span class="hljs-string">"peaceiris/mdbook:0.4.10"</span>,
                    },
                }
                Expect(k8sClient.Create(ctx, resource)).To(Succeed())
            }
        })

        AfterEach(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            <span class="hljs-comment">// TODO(user): Cleanup logic after each test, like removing the resource instance.</span>
            resource := &amp;viewv1.MarkdownView{}
            err := k8sClient.Get(ctx, typeNamespacedName, resource)
            Expect(err).NotTo(HaveOccurred())

            By(<span class="hljs-string">"Cleanup the specific resource instance MarkdownView"</span>)
            Expect(k8sClient.Delete(ctx, resource)).To(Succeed())

            err = k8sClient.DeleteAllOf(ctx, &amp;corev1.ConfigMap{}, client.InNamespace(testNamespace))
            Expect(err).NotTo(HaveOccurred())
            err = k8sClient.DeleteAllOf(ctx, &amp;appsv1.Deployment{}, client.InNamespace(testNamespace))
            Expect(err).NotTo(HaveOccurred())
            svcs := &amp;corev1.ServiceList{}
            err = k8sClient.List(ctx, svcs, client.InNamespace(testNamespace))
            Expect(err).NotTo(HaveOccurred())
            <span class="hljs-keyword">for</span> _, svc := <span class="hljs-keyword">range</span> svcs.Items {
                err := k8sClient.Delete(ctx, &amp;svc)
                Expect(err).NotTo(HaveOccurred())
            }
        })

        It(<span class="hljs-string">"should successfully reconcile the resource"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            By(<span class="hljs-string">"Reconciling the created resource"</span>)
            controllerReconciler := &amp;MarkdownViewReconciler{
                Client: k8sClient,
                Scheme: k8sClient.Scheme(),
            }

            _, err := controllerReconciler.Reconcile(ctx, reconcile.Request{
                NamespacedName: typeNamespacedName,
            })
            Expect(err).NotTo(HaveOccurred())

            By(<span class="hljs-string">"Making sure the ConfigMap created successfully"</span>)
            cm := corev1.ConfigMap{}
            err = k8sClient.Get(ctx, client.ObjectKey{Namespace: testNamespace, Name: <span class="hljs-string">"markdowns-sample"</span>}, &amp;cm)
            Expect(err).NotTo(HaveOccurred())
            Expect(cm.Data).Should(HaveKey(<span class="hljs-string">"SUMMARY.md"</span>))
            Expect(cm.Data).Should(HaveKey(<span class="hljs-string">"page1.md"</span>))

            By(<span class="hljs-string">"Making sure the Deployment created successfully"</span>)
            dep := appsv1.Deployment{}
            err = k8sClient.Get(ctx, client.ObjectKey{Namespace: testNamespace, Name: <span class="hljs-string">"viewer-sample"</span>}, &amp;dep)
            Expect(err).NotTo(HaveOccurred())
            Expect(dep.Spec.Replicas).Should(Equal(ptr.To[<span class="hljs-type">int32</span>](<span class="hljs-number">3</span>)))
            Expect(dep.Spec.Template.Spec.Containers[<span class="hljs-number">0</span>].Image).Should(Equal(<span class="hljs-string">"peaceiris/mdbook:0.4.10"</span>))

            By(<span class="hljs-string">"Making sure the Service created successfully"</span>)
            svc := corev1.Service{}
            err = k8sClient.Get(ctx, client.ObjectKey{Namespace: testNamespace, Name: <span class="hljs-string">"viewer-sample"</span>}, &amp;svc)
            Expect(err).NotTo(HaveOccurred())
            Expect(svc.Spec.Ports[<span class="hljs-number">0</span>].Port).Should(Equal(<span class="hljs-type">int32</span>(<span class="hljs-number">80</span>)))
            Expect(svc.Spec.Ports[<span class="hljs-number">0</span>].TargetPort).Should(Equal(intstr.FromInt32(<span class="hljs-number">3000</span>)))

            By(<span class="hljs-string">"Making sure the Status updated successfully"</span>)
            updated := viewv1.MarkdownView{}
            err = k8sClient.Get(ctx, typeNamespacedName, &amp;updated)
            Expect(err).NotTo(HaveOccurred())
            Expect(updated.Status).ShouldNot(BeEmpty(), <span class="hljs-string">"status should be updated"</span>)
        })
    })
})
</code></pre>
<p>まずは各テストの実行前と実行後に呼び出される<code>BeforeEach</code>と<code>AfterEach</code>を実装します。
<code>BeforeEach</code>では、テスト用のNamespaceとMarkdownViewリソースを作成しています。
<code>AfterEach</code>では、テストで利用したリソースを削除していmます。 (なお、Serviceリソースは<code>DeleteAllOf</code>をサポートしていないため、1つずつ削除しています。)</p>
<p>次に<code>It</code>を利用してテストケースを記述します。
このテストケースでは<code>k8sClient</code>を利用してKubernetesクラスターにMarkdownViewリソースを作成し、その後に期待するリソースが作成されていることを確認しています。</p>
<p>最後のテストではStatusが更新されることを確認しています。
本来はここでStatusがHealthyになることをテストすべきでしょう。
しかし、Envtestではcontroller-managerが存在しないためDeploymentがReadyにならず、MarkdownViewのStatusもHealthyになることはありません。
よってここではStatusが何かしら更新されればOKというテストにしています。
Envtestは実際のKubernetesクラスターとは異なるということを意識してテストを書くようにしましょう。</p>
<p>テストが書けたら、<code>make test</code>で実行してみましょう。
テストに成功すると以下のようにokと表示されます。</p>
<pre><code class="lang-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make <span class="hljs-built_in">test</span></span>
KUBEBUILDER_ASSETS="~/markdown-view/bin/k8s/1.30.0-linux-amd64" go test $(go list ./... | grep -v /e2e) -coverprofile cover.out
        github.com/zoetrope/markdown-view/cmd           coverage: 0.0% of statements
        github.com/zoetrope/markdown-view/test/utils            coverage: 0.0% of statements
ok      github.com/zoetrope/markdown-view/api/v1        5.573s  coverage: 51.6% of statements
ok      github.com/zoetrope/markdown-view/internal/controller   6.136s  coverage: 69.6% of statements
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="reconcile.html" class="navigation navigation-prev " aria-label="Previous page: Reconcileの実装">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="webhook.html" class="navigation navigation-next " aria-label="Next page: Webhookの実装">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"コントローラーのテスト(Envtest)","level":"1.4.4","depth":2,"next":{"title":"Webhookの実装","level":"1.4.5","depth":2,"path":"controller-runtime/webhook.md","ref":"controller-runtime/webhook.md","articles":[]},"previous":{"title":"Reconcileの実装","level":"1.4.3","depth":2,"path":"controller-runtime/reconcile.md","ref":"controller-runtime/reconcile.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-codeblock"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":false,"template":"/home/zoetrope/repos/github.com/zoetrope/kubebuilder-training/template.hbs","theme":"chrome","unindent":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"つくって学ぶKubebuilder","gitbook":"*"},"file":{"path":"controller-runtime/controller_test.md","mtime":"2024-08-16T09:19:47.377Z","type":"markdown"},"gitbook":{"version":"5.1.4","time":"2024-08-16T09:20:13.853Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

