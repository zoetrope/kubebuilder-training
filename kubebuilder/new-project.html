
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>プロジェクトの雛形作成 · つくって学ぶKubebuilder</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.4">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="api.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    つくって学ぶKubebuilder
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../introduction/installation.html">
            
                <a href="../introduction/installation.html">
            
                    
                    インストール
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../introduction/basics.html">
            
                <a href="../introduction/basics.html">
            
                    
                    カスタムコントローラーの基礎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../introduction/sample.html">
            
                <a href="../introduction/sample.html">
            
                    
                    MarkdownViewコントローラー
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../introduction/references.html">
            
                <a href="../introduction/references.html">
            
                    
                    参考情報
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    Kubebuilder
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.1" data-path="new-project.html">
            
                <a href="new-project.html">
            
                    
                    プロジェクトの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="api.html">
            
                <a href="api.html">
            
                    
                    APIの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="webhook.html">
            
                <a href="webhook.html">
            
                    
                    Webhookの雛形作成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="kind.html">
            
                <a href="kind.html">
            
                    
                    カスタムコントローラーの動作確認
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="release.html">
            
                <a href="release.html">
            
                    
                    カスタムコントローラーのリリース
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../controller-tools/">
            
                <a href="../controller-tools/">
            
                    
                    controller-tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../controller-tools/crd.html">
            
                <a href="../controller-tools/crd.html">
            
                    
                    CRDマニフェストの生成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../controller-tools/rbac.html">
            
                <a href="../controller-tools/rbac.html">
            
                    
                    RBACマニフェストの生成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../controller-tools/webhook.html">
            
                <a href="../controller-tools/webhook.html">
            
                    
                    Webhookマニフェストの生成
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../controller-runtime/">
            
                <a href="../controller-runtime/">
            
                    
                    controller-runtime
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../controller-runtime/client.html">
            
                <a href="../controller-runtime/client.html">
            
                    
                    クライアントの使い方
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../controller-runtime/test.html">
            
                <a href="../controller-runtime/test.html">
            
                    
                    テスト
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../controller-runtime/reconcile.html">
            
                <a href="../controller-runtime/reconcile.html">
            
                    
                    Reconcileの実装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../controller-runtime/controller_test.html">
            
                <a href="../controller-runtime/controller_test.html">
            
                    
                    コントローラーのテスト(Envtest)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../controller-runtime/webhook.html">
            
                <a href="../controller-runtime/webhook.html">
            
                    
                    Webhookの実装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../controller-runtime/webhook_test.html">
            
                <a href="../controller-runtime/webhook_test.html">
            
                    
                    Webhookのテスト(Envtest)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../controller-runtime/deletion.html">
            
                <a href="../controller-runtime/deletion.html">
            
                    
                    リソースの削除
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../controller-runtime/manager.html">
            
                <a href="../controller-runtime/manager.html">
            
                    
                    Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../controller-runtime/monitoring.html">
            
                <a href="../controller-runtime/monitoring.html">
            
                    
                    モニタリング
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >プロジェクトの雛形作成</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="プロジェクトの雛形作成">プロジェクトの雛形作成</h1>
<p>それではさっそく<code>kubebuilder init</code>コマンドを利用して、プロジェクトの雛形を生成しましょう。</p>
<pre><code class="lang-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> markdown-view</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> markdown-view</span>
<span class="hljs-meta prompt_">$ </span><span class="language-bash">kubebuilder init --domain zoetrope.github.io --repo github.com/zoetrope/markdown-view</span>
</code></pre>
<p><code>--domain</code>で指定した名前は、これから作成するカスタムリソースのグループ名に使われます。
他の人の作ったカスタムリソースと衝突しないように、あなたが保持するドメインなどを利用してユニークな名前を指定してください。</p>
<p><code>--repo</code>にはgo modulesのmodule名を指定します。
GitHubにリポジトリを作る場合は<code>github.com/&lt;user_name&gt;/&lt;product_name&gt;</code>を指定します。</p>
<p>コマンドの実行に成功すると、下記のようなファイルが生成されます。</p>
<pre><code>.
├── cmd
│    └── main.go
├── config
│    ├── default
│    │    ├── kustomization.yaml
│    │    ├── manager_metrics_patch.yaml
│    │    └── metrics_service.yaml
│    ├── manager
│    │    ├── kustomization.yaml
│    │    └── manager.yaml
│    ├── prometheus
│    │    ├── kustomization.yaml
│    │    └── monitor.yaml
│    └── rbac
│        ├── kustomization.yaml
│        ├── leader_election_role_binding.yaml
│        ├── leader_election_role.yaml
│        ├── metrics_auth_role_binding.yaml
│        ├── metrics_auth_role.yaml
│        ├── metrics_reader_role.yaml
│        ├── role_binding.yaml
│        ├── role.yaml
│        └── service_account.yaml
├── Dockerfile
├── go.mod
├── go.sum
├── hack
│    └── boilerplate.go.txt
├── Makefile
├── PROJECT
├── README.md
└── test
    ├── e2e
    │    ├── e2e_suite_test.go
    │    └── e2e_test.go
    └── utils
        └── utils.go
</code></pre><p>それでは生成されたファイルをそれぞれ見ていきましょう。</p>
<h2 id="makefile">Makefile</h2>
<p>コード生成やコントローラーのビルドなどをおこなうためのMakefileです。</p>
<p><code>make help</code>でターゲットの一覧を確認してみましょう。</p>
<pre><code class="lang-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make <span class="hljs-built_in">help</span></span>

Usage:
  make &lt;target&gt;

General
  help             Display this help.

Development
  manifests        Generate WebhookConfiguration, ClusterRole and CustomResourceDefinition objects.
  generate         Generate code containing DeepCopy, DeepCopyInto, and DeepCopyObject method implementations.
  fmt              Run go fmt against code.
  vet              Run go vet against code.
  test             Run tests.
  lint             Run golangci-lint linter
  lint-fix         Run golangci-lint linter and perform fixes

Build
  build            Build manager binary.
  run              Run a controller from your host.
  docker-build     Build docker image with the manager.
  docker-push      Push docker image with the manager.
  docker-buildx    Build and push docker image for the manager for cross-platform support
  build-installer  Generate a consolidated YAML with CRDs and deployment.

Deployment
  install          Install CRDs into the K8s cluster specified in ~/.kube/config.
  uninstall        Uninstall CRDs from the K8s cluster specified in ~/.kube/config. Call with ignore-not-found=true to ignore resource not found errors during deletion.
  deploy           Deploy controller to the K8s cluster specified in ~/.kube/config.
  undeploy         Undeploy controller from the K8s cluster specified in ~/.kube/config. Call with ignore-not-found=true to ignore resource not found errors during deletion.

Dependencies
  kustomize        Download kustomize locally if necessary.
  controller-gen   Download controller-gen locally if necessary.
  envtest          Download setup-envtest locally if necessary.
  golangci-lint    Download golangci-lint locally if necessary.
</code></pre>
<h2 id="project">PROJECT</h2>
<p>ドメイン名やリポジトリのURLや生成したAPIの情報などが記述されています。
基本的にこのファイルを編集することはあまりないでしょう。</p>
<h2 id="hackboilerplategotxt">hack/boilerplate.go.txt</h2>
<p>自動生成されるソースコードの先頭に挿入されるボイラープレートです。</p>
<p>デフォルトではApache 2 Licenseの文面が記述されているので、必要に応じて書き換えてください。</p>
<h2 id="cmdmaingo">cmd/main.go</h2>
<p>これから作成するカスタムコントローラーのエントリーポイントとなるソースコードです。</p>
<p>ソースコード中に<code>//+kubebuilder:scaffold:imports</code>, <code>//+kubebuilder:scaffold:scheme</code>, <code>//+kubebuilder:scaffold:builder</code>などのコメントが記述されています。
Kubebuilderはこれらのコメントを目印にソースコードの自動生成をおこなうので、決して削除しないように注意してください。</p>
<h2 id="config">config</h2>
<p>configディレクトリ配下には、カスタムコントローラーをKubernetesクラスターにデプロイするためのマニフェストが生成されます。</p>
<p>実装する機能によっては必要のないマニフェストも含まれているので、適切に取捨選択してください。</p>
<h3 id="default">default</h3>
<p>マニフェストをまとめて利用するための設定が記述されています。</p>
<p><code>manager_metrics_patch.yaml</code>は、カスタムコントローラーのメトリクスを有効にするためのパッチです。</p>
<p><code>metrics_service.yaml</code>は、カスタムコントローラーのメトリクスにアクセスするためのサービス定義です。</p>
<p>利用するマニフェストに応じて、<code>kustomization.yaml</code>を編集してください。</p>
<h3 id="manager">manager</h3>
<p>カスタムコントローラーのDeploymentリソースのマニフェストです。
カスタムコントローラーのコマンドラインオプションの変更をおこなった場合など、必要に応じて書き換えてください。</p>
<h3 id="prometheus">prometheus</h3>
<p>カスタムリソースのメトリクスを収集するための設定を記述したマニフェストです。
Prometheus Operatorを利用している場合、このマニフェストを適用するとPrometheusが自動的にカスタムコントローラーのメトリクスを収集してくれるようになります。</p>
<h3 id="rbac">rbac</h3>
<p>各種権限を設定するためのマニフェストです。</p>
<p><code>leader_election_role.yaml</code>と<code>leader_election_role_binding.yaml</code>は、リーダーエレクション機能を利用するために必要な権限です。</p>
<p><code>metrics_auth_</code>から始まるファイルは、メトリクスエンドポイントへのアクセスを制限するためのマニフェストです。</p>
<p><code>role.yaml</code>と<code>role_binding.yaml</code>は、コントローラーが各種リソースにアクセスするための権限を設定するマニフェストです。
この2つのファイルは自動生成されるものなので、手動で編集しないように注意してください。
<code>service_account</code>は、カスタムコントローラーのサービスアカウントを定義するマニフェストで、<code>role.yaml</code>で定義した権限が割り当てられます。</p>
<h2 id="test">test</h2>
<p>E2Eテストをおこなうためのファイルが格納されています。</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Kubebuilder">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="api.html" class="navigation navigation-next " aria-label="Next page: APIの雛形作成">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"プロジェクトの雛形作成","level":"1.2.1","depth":2,"next":{"title":"APIの雛形作成","level":"1.2.2","depth":2,"path":"kubebuilder/api.md","ref":"kubebuilder/api.md","articles":[]},"previous":{"title":"Kubebuilder","level":"1.2","depth":1,"path":"kubebuilder/README.md","ref":"kubebuilder/README.md","articles":[{"title":"プロジェクトの雛形作成","level":"1.2.1","depth":2,"path":"kubebuilder/new-project.md","ref":"kubebuilder/new-project.md","articles":[]},{"title":"APIの雛形作成","level":"1.2.2","depth":2,"path":"kubebuilder/api.md","ref":"kubebuilder/api.md","articles":[]},{"title":"Webhookの雛形作成","level":"1.2.3","depth":2,"path":"kubebuilder/webhook.md","ref":"kubebuilder/webhook.md","articles":[]},{"title":"カスタムコントローラーの動作確認","level":"1.2.4","depth":2,"path":"kubebuilder/kind.md","ref":"kubebuilder/kind.md","articles":[]},{"title":"カスタムコントローラーのリリース","level":"1.2.5","depth":2,"path":"kubebuilder/release.md","ref":"kubebuilder/release.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["include-codeblock"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":false,"template":"/home/zoetrope/repos/github.com/zoetrope/kubebuilder-training/template.hbs","theme":"chrome","unindent":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"つくって学ぶKubebuilder","gitbook":"*"},"file":{"path":"kubebuilder/new-project.md","mtime":"2024-08-16T09:19:47.377Z","type":"markdown"},"gitbook":{"version":"5.1.4","time":"2024-08-16T09:20:13.853Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

